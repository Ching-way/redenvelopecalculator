<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>è¾²æ›†æ–°å¹´ç´…åŒ…æ›æ–°éˆ”è¨ˆç®—å™¨</title>
    <!--
    ==========================================
    è¾²æ›†æ–°å¹´ç´…åŒ…æ›æ–°éˆ”è¨ˆç®—å™¨
    å”ä½œè€…: Ching & Claude
    ==========================================
    
    ç‰ˆæœ¬æ­·ç¨‹:
    
    v1.8.0 (2025-02-05)
    - æ–°å¢: åˆ—å°åŠŸèƒ½(ç”¢ç”Ÿå°ˆæ¥­åˆ—å°æ ¼å¼,å¯åˆ—å°çµ±è¨ˆè¡¨æ ¼)
    - æ–°å¢: å¿«é€Ÿè¤‡è£½åŠŸèƒ½(ä¸€éµè¤‡è£½ç´…åŒ…è³‡æ–™åˆ°è¼¸å…¥æ¬„ä½)
    - æ–°å¢: æœå°‹/ç¯©é¸åŠŸèƒ½(å³æ™‚æœå°‹é€ç¦®äººæˆ–æ”¶ç¦®äºº)
    - æ–°å¢: æ’åºåŠŸèƒ½(ä¾é€ç¦®äºº/æ”¶ç¦®äºº/é‡‘é¡æ’åº)
    - æ–°å¢: é‡‘é¡ç¯„æœ¬(å¸¸ç”¨é‡‘é¡å¿«é€Ÿé¸æ“‡:600/1000/1200/1600/2000/3600/6000)
    - å„ªåŒ–: å¿«é€Ÿè¤‡è£½å¾Œè‡ªå‹•æ²å‹•åˆ°è¼¸å…¥å€åŸŸ
    - å„ªåŒ–: æœå°‹/ç¯©é¸æ™‚ä¿æŒåŸå§‹ç´¢å¼•æ­£ç¢ºæ€§
    - å„ªåŒ–: åˆ—å°æ ¼å¼åŒ…å«ä½¿ç”¨èªªæ˜å’Œæ—¥æœŸæ™‚é–“
    
    v1.7.1 (2025-02-05)
    - æ–°å¢: è³‡æ–™æ•¸é‡å³æ™‚é¡¯ç¤º(å·²æœ‰ X ç­†)
    - æ–°å¢: æ¸…ç©ºå…¨éƒ¨æŒ‰éˆ•(å¿«é€Ÿæ¸…é™¤æ‰€æœ‰ç´…åŒ…è³‡æ–™)
    - æ–°å¢: éš±ç§ä¿è­‰èªªæ˜å€å¡Š(è—è‰²æç¤ºæ¡†)
    - æ–°å¢: localStorageéš±ç§æ€§èªªæ˜æ–‡ä»¶
    - ç¢ºèª: localStorageè³‡æ–™å®Œå…¨éš”é›¢,ä¸åŒä½¿ç”¨è€…/è£ç½®çµ•å°çœ‹ä¸åˆ°å½¼æ­¤è³‡æ–™
    - å„ªåŒ–: æ¸…ç©ºå…¨éƒ¨æ™‚æœƒæç¤ºç­†æ•¸ä¸¦ç¢ºèª
    - å„ªåŒ–: æ¸…ç©ºæ™‚ä¸å½±éŸ¿å·²å„²å­˜çš„è³‡æ–™
    
    v1.7.0 (2025-02-05)
    - æ–°å¢: åŒ¯å‡ºç´”æ–‡å­—åŠŸèƒ½(å¯è¤‡è£½åˆ†äº«çµ¦ä»–äºº)
    - æ–°å¢: åŒ¯å‡ºExcelåŠŸèƒ½(å«4å€‹å·¥ä½œè¡¨:æ˜ç´°ã€é€ç¦®äººçµ±è¨ˆã€æ”¶ç¦®äººçµ±è¨ˆã€ç¸½è¨ˆ)
    - æ–°å¢: è‡ªå‹•å„²å­˜åŠŸèƒ½(ä½¿ç”¨localStorage)
    - æ–°å¢: æ‰‹å‹•å„²å­˜/è¼‰å…¥/æ¸…é™¤æŒ‰éˆ•
    - æ–°å¢: é é¢è‡ªå‹•è¼‰å…¥ä¸Šæ¬¡å„²å­˜çš„è³‡æ–™
    - ä¾è³´: å¼•å…¥SheetJS(xlsx.js)å‡½å¼åº«
    
    v1.6.1 (2025-02-05)
    - ä¿®æ­£: æ‰€æœ‰ç¯„ä¾‹æ–‡å­—å¾ã€Œç‹å¤§æ˜ã€æ”¹ç‚ºã€Œå‘‚å°é’ã€
    - å„ªåŒ–: ç¨±è¬‚æé†’æ–‡å­—æ›´æ¸…æ¥šèªªæ˜é—œä¿‚æ€§å•é¡Œ
    - å„ªåŒ–: è¼¸å…¥æ¬„ä½ç¯„ä¾‹æ›´æ–°(å‘‚å°é’ã€é™³é˜¿å¬¤ã€æä¼¯ä¼¯)
    - æ›´æ–°: è¨ˆç®—é‚è¼¯èªªæ˜æ–‡ä»¶ä¸­çš„æ‰€æœ‰ç¯„ä¾‹
    
    v1.6.0 (2025-02-05)
    - æ–°å¢: 5å…ƒç¡¬å¹£é¸é …
    - æ–°å¢: æ”¶ç¦®äººçµ±è¨ˆå€åŸŸ(ç´¯è¨ˆä¾†è‡ªä¸åŒé€ç¦®äººçš„é‡‘é¡èˆ‡æ˜ç´°)
    - æ–°å¢: ç¨±è¬‚æé†’å€å¡Š(æé†’ä½¿ç”¨è€…æ³¨æ„ç¨±è¬‚æ­£ç¢ºæ€§)
    - å„ªåŒ–: æ”¶ç¦®äººçµ±è¨ˆæ¡ç”¨èˆ‡é€ç¦®äººçµ±è¨ˆç›¸åŒçš„é»‘ç™½é…è‰²
    - å„ªåŒ–: æ‰€æœ‰è¨ˆç®—é‚è¼¯åŠ å…¥5å…ƒç¡¬å¹£æ”¯æ´
    
    v1.5.0 (2025-02-05)
    - é‡è¦: èª¿æ•´è‡ªå‹•è¨ˆç®—é‚è¼¯,å„ªå…ˆä½¿ç”¨å¸¸ç”¨é¢é¡ (1000ã€500ã€100)
    - å„ªåŒ–: é¿å…è‡ªå‹•ä½¿ç”¨è¼ƒå°‘æµé€šçš„ 2000ã€200 å…ƒ
    - å„ªåŒ–: é¢é¡è¼¸å…¥æ¬„ä½é‡æ–°æ’åº,å¸¸ç”¨é¢é¡æ¨™ç¤ºâ­
    - æ›´æ–°: è¨ˆç®—é‚è¼¯èªªæ˜æ–‡ä»¶,å¢åŠ å°ç£é¢é¡ä½¿ç”¨ç¿’æ…£èªªæ˜
    - å„ªåŒ–: æ›´è²¼è¿‘å°ç£å¯¦éš›ç”¨éˆ”ç¿’æ…£
    
    v1.4.0 (2025-02-05)
    - æ–°å¢: ã€Œä½¿ç”¨æ­¤é‡‘é¡ã€æŒ‰éˆ•,æ”¯æ´å…©ç¨®æ–°å¢ç´…åŒ…æ–¹å¼
    - æ–°å¢: å¿…å¡«æ¬„ä½é©—è­‰æç¤º(æ‰‹æ©Ÿ/PCçš†é©ç”¨)
    - æ–°å¢: é¢é¡è¨ˆç®—é‚è¼¯èªªæ˜æ–‡ä»¶
    - å„ªåŒ–: æ”¹é€²è¡¨å–®é©—è­‰,åŠ å…¥focusç„¦é»å¼•å°
    - å„ªåŒ–: å°è¨ˆå€åŸŸåŠ å…¥è—è‰²ã€Œä½¿ç”¨æ­¤é‡‘é¡ã€æŒ‰éˆ•
    - æ–°å¢: é¢é¡æŒ‡å®šèªªæ˜æ–‡å­—(é»ƒè‰²æç¤ºæ¡†)
    
    v1.3.1 (2025-02-05)
    - ä¿®æ­£: å„ªåŒ–éŸ¿æ‡‰å¼è¨­è¨ˆ,ä¿®æ­£æ‰‹æ©Ÿç‰ˆæ¬„ä½è¶…å‡ºå•é¡Œ
    - å„ªåŒ–: æ–°å¢480pxæ–·é»,å®Œæ•´æ”¯æ´å°è¢å¹•æ‰‹æ©Ÿ
    - å„ªåŒ–: é¢é¡è¼¸å…¥æ¬„æ”¹ç‚ºæ©«å‘æ’åˆ—(æ‰‹æ©Ÿç‰ˆ)
    - å„ªåŒ–: æ‰€æœ‰å­—é«”å¤§å°å’Œé–“è·é‡å°æ‰‹æ©Ÿå„ªåŒ–
    - ä¿®æ­£: iOSè¼¸å…¥æ¡†è‡ªå‹•ç¸®æ”¾å•é¡Œ
    
    v1.3.0 (2025-02-05)
    - æ–°å¢: å”ä½œè€…è³‡è¨Šèˆ‡ç‰ˆæœ¬è¿½è¹¤ç³»çµ±
    - å„ªåŒ–: é€ç¦®äººçµ±è¨ˆå€å¡Šæ”¹ç‚ºé»‘ç™½é…è‰²è¨­è¨ˆ
    - æ–°å¢: æŒ‡å®šé¢é¡å³æ™‚å°è¨ˆåŠŸèƒ½
    - æ–°å¢: é€ç¦®äººçµ±è¨ˆä¸­çš„ç´…åŒ…æ˜ç´°æ‘˜è¦
    
    v1.2.0 (2025-02-05)
    - æ–°å¢: å„é€ç¦®äººæ›éˆ”çµ±è¨ˆ(ä¸¦æ’é¡¯ç¤º)
    - æ–°å¢: é‡è¤‡é€ç¦®äºº+æ”¶ç¦®äººç¢ºèªæç¤º
    
    v1.1.0 (2025-02-05)
    - æ–°å¢: é€ç¦®äººæ¬„ä½
    - æ–°å¢: ç¡¬å¹£é¢é¡æ”¯æ´(50å…ƒã€10å…ƒã€1å…ƒ)
    - å„ªåŒ–: ç´™éˆ”/ç¡¬å¹£åˆ†é¡é¡¯ç¤º
    
    v1.0.0 (2025-02-05)
    - åˆå§‹ç‰ˆæœ¬
    - åŸºæœ¬ç´…åŒ…è¨ˆç®—åŠŸèƒ½
    - æ”¯æ´ç´™éˆ”é¢é¡(2000ã€1000ã€500ã€200ã€100å…ƒ)
    - è‡ªå‹•è¨ˆç®—èˆ‡æ‰‹å‹•æŒ‡å®šé¢é¡
    
    ==========================================
    -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #ff6b6b;
        }

        .header h1 {
            color: #c92a2a;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
            margin-bottom: 12px;
        }

        .collaborators {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 12px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
        }

        .collab-label,
        .version-label {
            font-weight: bold;
            color: #495057;
        }

        .collab-names {
            color: #c92a2a;
            font-weight: 600;
        }

        .version-number {
            color: #fff;
            background: #51cf66;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 13px;
        }

        .input-section {
            background: #fff5f5;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid #ffc9c9;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1.5fr 1.5fr 1.5fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #495057;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"] {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        .denomination-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .denomination-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #ffc9c9;
        }

        .section-title {
            font-weight: bold;
            color: #c92a2a;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .denomination-help-text {
            font-size: 13px;
            color: #495057;
            background: #fff3cd;
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid #ffc107;
        }

        .subtotal-container {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
            margin-top: 12px;
        }

        .subtotal-display {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(64, 192, 87, 0.3);
            border: 2px solid #37b24d;
        }

        .subtotal-label {
            font-size: 13px;
            margin-bottom: 4px;
            opacity: 0.95;
        }

        .subtotal-amount {
            font-size: 22px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .btn-use-subtotal {
            background: linear-gradient(135deg, #339af0 0%, #228be6 100%);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(34, 139, 230, 0.3);
            white-space: nowrap;
        }

        .btn-use-subtotal:hover:not(:disabled) {
            background: linear-gradient(135deg, #228be6 0%, #1c7ed6 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 139, 230, 0.4);
        }

        .btn-use-subtotal:disabled {
            background: #adb5bd;
            cursor: not-allowed;
            box-shadow: none;
        }

        .denomination-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .denomination-item input[type="number"] {
            width: 100%;
            padding: 8px;
            font-size: 14px;
        }

        .denomination-item label {
            margin: 0;
            font-size: 13px;
            text-align: center;
            color: #495057;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-add {
            background: #51cf66;
            color: white;
        }

        .btn-add:hover {
            background: #40c057;
            transform: translateY(-2px);
        }

        .btn-remove {
            background: #ff6b6b;
            color: white;
            padding: 8px 15px;
            font-size: 14px;
        }

        .btn-remove:hover {
            background: #fa5252;
        }

        .recipient-list {
            margin-bottom: 25px;
        }

        .recipient-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            align-items: start;
        }

        .recipient-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-label {
            font-weight: bold;
            color: #868e96;
            min-width: 80px;
        }

        .info-value {
            color: #212529;
            font-size: 16px;
        }

        .amount-value {
            color: #c92a2a;
            font-size: 20px;
            font-weight: bold;
        }

        .summary-section {
            background: linear-gradient(135deg, #fa5252 0%, #c92a2a 100%);
            padding: 30px;
            border-radius: 15px;
            color: white;
            margin-top: 30px;
        }

        #giverSummary,
        #recipientSummary {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #212529;
        }

        #giverSummaryContent,
        #recipientSummaryContent {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .giver-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #dee2e6;
            display: flex;
            flex-direction: column;
            height: 100%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .giver-card:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
            border-color: #adb5bd;
        }

        .recipient-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #dee2e6;
            display: flex;
            flex-direction: column;
            height: 100%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .recipient-card:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
            border-color: #adb5bd;
        }

        .recipient-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #212529;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }

        .recipient-givers {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #dee2e6;
        }

        .recipient-givers-title {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #495057;
            text-align: center;
        }

        .giver-summary {
            font-size: 13px;
            line-height: 1.6;
            color: #495057;
            margin-bottom: 4px;
        }

        .giver-summary:last-child {
            margin-bottom: 0;
        }

        .giver-summary-name {
            font-weight: 600;
            color: #212529;
        }

        .giver-summary-amount {
            color: #c92a2a;
            font-weight: bold;
        }

        .recipient-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
        }

        .recipient-bill-section,
        .recipient-coin-section {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .recipient-category-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            color: #495057;
        }

        .recipient-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 8px;
        }

        .recipient-denom-item {
            background: white;
            padding: 8px 6px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .recipient-denom-label {
            font-size: 12px;
            margin-bottom: 4px;
            color: #6c757d;
        }

        .recipient-denom-count {
            font-size: 18px;
            font-weight: bold;
            color: #212529;
        }

        .recipient-total {
            background: #212529;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin-top: 12px;
            border: 2px solid #495057;
        }

        .recipient-total-label {
            font-size: 13px;
            margin-bottom: 5px;
            color: #adb5bd;
        }

        .recipient-total-amount {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }

        .giver-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #212529;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }

        .giver-recipients {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #dee2e6;
        }

        .giver-recipients-title {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #495057;
            text-align: center;
        }

        .recipient-summary {
            font-size: 13px;
            line-height: 1.6;
            color: #495057;
            margin-bottom: 4px;
        }

        .recipient-summary:last-child {
            margin-bottom: 0;
        }

        .recipient-summary-name {
            font-weight: 600;
            color: #212529;
        }

        .recipient-summary-amount {
            color: #c92a2a;
            font-weight: bold;
        }

        .giver-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
        }

        .giver-bill-section,
        .giver-coin-section {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .giver-category-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            color: #495057;
        }

        .giver-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 8px;
        }

        .giver-denom-item {
            background: white;
            padding: 8px 6px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .giver-denom-label {
            font-size: 12px;
            margin-bottom: 4px;
            color: #6c757d;
        }

        .giver-denom-count {
            font-size: 18px;
            font-weight: bold;
            color: #212529;
        }

        .giver-total {
            background: #212529;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin-top: 12px;
            border: 2px solid #495057;
        }

        .giver-total-label {
            font-size: 13px;
            margin-bottom: 5px;
            color: #adb5bd;
        }

        .giver-total-amount {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }

        @media (max-width: 1024px) {
            #giverSummaryContent {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            #giverSummaryContent {
                grid-template-columns: 1fr;
            }
        }

        .summary-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .summary-categories {
            display: grid;
            gap: 20px;
            margin-bottom: 20px;
        }

        .category-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .category-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            color: #ffd43b;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }

        .summary-card {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .summary-denomination {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .summary-count {
            font-size: 28px;
            font-weight: bold;
            color: #ffd43b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .summary-total {
            background: rgba(255,255,255,0.25);
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            border: 3px solid rgba(255,255,255,0.5);
        }

        .total-label {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .total-amount {
            font-size: 42px;
            font-weight: bold;
            color: #ffd43b;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        }

        .storage-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-storage {
            padding: 8px 16px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #495057;
        }

        .btn-save {
            border-color: #51cf66;
            color: #2b8a3e;
        }

        .btn-save:hover {
            background: #51cf66;
            color: white;
            transform: translateY(-2px);
        }

        .btn-load {
            border-color: #339af0;
            color: #1864ab;
        }

        .btn-load:hover {
            background: #339af0;
            color: white;
            transform: translateY(-2px);
        }

        .btn-clear {
            border-color: #ff6b6b;
            color: #c92a2a;
        }

        .btn-clear:hover {
            background: #ff6b6b;
            color: white;
            transform: translateY(-2px);
        }

        .export-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-export {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .btn-export-text {
            background: linear-gradient(135deg, #4dabf7 0%, #339af0 100%);
            color: white;
        }

        .btn-export-text:hover {
            background: linear-gradient(135deg, #339af0 0%, #228be6 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(51, 154, 240, 0.4);
        }

        .btn-export-excel {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
        }

        .btn-export-excel:hover {
            background: linear-gradient(135deg, #40c057 0%, #37b24d 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(64, 192, 87, 0.4);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #868e96;
            font-size: 18px;
        }

        .naming-reminder {
            background: linear-gradient(135deg, #fff3cd 0%, #fff8e1 100%);
            border: 2px solid #ffc107;
            border-left: 5px solid #ff9800;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
            display: flex;
            gap: 15px;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.15);
        }

        .reminder-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .reminder-content {
            flex: 1;
        }

        .reminder-title {
            font-size: 18px;
            font-weight: bold;
            color: #e65100;
            margin-bottom: 8px;
        }

        .reminder-text {
            font-size: 14px;
            color: #5d4037;
            line-height: 1.6;
        }

        .privacy-notice {
            background: linear-gradient(135deg, #e3f2fd 0%, #e1f5fe 100%);
            border: 2px solid #2196f3;
            border-left: 5px solid #1976d2;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
            display: flex;
            gap: 15px;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15);
        }

        .privacy-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .privacy-content {
            flex: 1;
        }

        .privacy-title {
            font-size: 18px;
            font-weight: bold;
            color: #0d47a1;
            margin-bottom: 8px;
        }

        .privacy-text {
            font-size: 14px;
            color: #1565c0;
            line-height: 1.6;
        }

        .btn-clear-all {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-clear-all:hover {
            background: #fa5252;
            transform: translateY(-2px);
        }

        .amount-templates {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .btn-template {
            background: #f1f3f5;
            border: 1px solid #dee2e6;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-template:hover {
            background: #51cf66;
            color: white;
            border-color: #51cf66;
            transform: scale(1.05);
        }

        .search-filter-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .search-filter-controls {
            display: grid;
            gap: 15px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #339af0;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-filter {
            padding: 10px 16px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-filter:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
        }

        .btn-filter.active {
            background: #339af0;
            color: white;
            border-color: #339af0;
        }

        .btn-copy {
            background: #4dabf7;
            color: white;
            padding: 8px 15px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-copy:hover {
            background: #339af0;
        }

        .btn-export-print {
            background: linear-gradient(135deg, #9775fa 0%, #845ef7 100%);
            color: white;
        }

        .btn-export-print:hover {
            background: linear-gradient(135deg, #845ef7 0%, #7950f2 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(132, 94, 247, 0.4);
        }

        @media print {
            body * {
                visibility: hidden;
            }
            #printArea, #printArea * {
                visibility: visible;
            }
            #printArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none !important;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 24px;
            }

            .header p {
                font-size: 14px;
            }

            .collaborators {
                font-size: 12px;
                gap: 8px;
                padding: 8px;
            }

            .version-number {
                font-size: 11px;
                padding: 3px 10px;
            }

            .input-section {
                padding: 20px 15px;
            }

            .input-group {
                grid-template-columns: 1fr;
            }

            .recipient-info {
                grid-template-columns: 1fr;
            }

            .recipient-item {
                grid-template-columns: 1fr;
                padding: 15px;
            }

            .info-item {
                flex-direction: row;
                gap: 10px;
            }

            .denomination-group {
                grid-template-columns: repeat(2, 1fr);
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .summary-title {
                font-size: 20px;
            }

            .total-amount {
                font-size: 36px;
            }

            .giver-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px 10px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 20px;
                line-height: 1.3;
            }

            .header p {
                font-size: 13px;
            }

            .collaborators {
                flex-direction: column;
                gap: 6px;
                font-size: 11px;
            }

            .input-section {
                padding: 15px 12px;
            }

            .section-title {
                font-size: 13px;
            }

            .form-group label {
                font-size: 13px;
            }

            input[type="text"],
            input[type="number"] {
                padding: 10px;
                font-size: 16px; /* é˜²æ­¢ iOS è‡ªå‹•ç¸®æ”¾ */
            }

            .denomination-group {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .denomination-item {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                background: white;
                padding: 10px;
                border-radius: 8px;
                border: 1px solid #dee2e6;
            }

            .denomination-item label {
                order: -1;
                font-size: 14px;
                margin-bottom: 0;
            }

            .denomination-item input[type="number"] {
                width: 80px;
                padding: 8px;
            }

            button {
                width: 100%;
                padding: 12px;
                font-size: 15px;
            }

            .btn-remove {
                width: 100%;
                margin-top: 10px;
            }

            .recipient-item {
                padding: 12px;
            }

            .info-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .info-label {
                font-size: 12px;
            }

            .info-value {
                font-size: 14px;
            }

            .amount-value {
                font-size: 18px;
            }

            .summary-section {
                padding: 20px 15px;
            }

            .summary-title {
                font-size: 18px;
            }

            .summary-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .summary-card {
                padding: 12px;
            }

            .summary-denomination {
                font-size: 15px;
            }

            .summary-count {
                font-size: 24px;
            }

            .total-amount {
                font-size: 28px;
            }

            .giver-card {
                padding: 15px;
            }

            .giver-name {
                font-size: 18px;
            }

            .giver-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }

            .giver-denom-item {
                padding: 6px 4px;
            }

            .giver-denom-label {
                font-size: 11px;
            }

            .giver-denom-count {
                font-size: 16px;
            }

            .subtotal-container {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .subtotal-display {
                padding: 10px 15px;
            }

            .subtotal-label {
                font-size: 12px;
            }

            .subtotal-amount {
                font-size: 20px;
            }

            .btn-use-subtotal {
                width: 100%;
                padding: 12px;
            }

            .btn-storage {
                font-size: 11px;
                padding: 6px 12px;
            }

            .btn-export {
                width: 100%;
                font-size: 14px;
            }

            .amount-templates {
                justify-content: flex-start;
            }

            .btn-template {
                font-size: 11px;
                padding: 5px 10px;
            }

            .filter-buttons {
                flex-direction: column;
            }

            .btn-filter {
                width: 100%;
            }

            .denomination-help-text {
                font-size: 12px;
                padding: 6px 10px;
            }

            .empty-state {
                padding: 30px 15px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§§ è¾²æ›†æ–°å¹´ç´…åŒ…æ›æ–°éˆ”è¨ˆç®—å™¨ ğŸ§§</h1>
            <p>è¼•é¬†è¨ˆç®—éœ€è¦å…Œæ›çš„æ–°éˆ”é¢é¡èˆ‡æ•¸é‡</p>
            <div class="collaborators">
                <span class="collab-label">ğŸ‘¥ å”ä½œè€…:</span>
                <span class="collab-names">Ching & Claude</span>
                <span class="version-label">ğŸ“Œ ç‰ˆæœ¬:</span>
                <span class="version-number">v1.8.0</span>
            </div>
            <div class="storage-buttons">
                <button class="btn-storage btn-save" onclick="saveData()" title="å„²å­˜è³‡æ–™åˆ°ç€è¦½å™¨">
                    ğŸ’¾ å„²å­˜è³‡æ–™
                </button>
                <button class="btn-storage btn-load" onclick="loadData()" title="è¼‰å…¥å·²å„²å­˜çš„è³‡æ–™">
                    ğŸ“‚ è¼‰å…¥è³‡æ–™
                </button>
                <button class="btn-storage btn-clear" onclick="clearStorage()" title="æ¸…é™¤æ‰€æœ‰å·²å„²å­˜è³‡æ–™">
                    ğŸ—‘ï¸ æ¸…é™¤å„²å­˜
                </button>
            </div>
        </div>

        <div class="input-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: #c92a2a;">æ–°å¢ç´…åŒ…</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span id="dataCount" style="font-size: 14px; color: #868e96;">å·²æœ‰ 0 ç­†</span>
                    <button class="btn-clear-all" onclick="clearAllRecipients()" title="æ¸…ç©ºæ‰€æœ‰ç´…åŒ…è³‡æ–™">
                        ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨
                    </button>
                </div>
            </div>
            <div class="input-group">
                <div class="form-group">
                    <label>é€ç¦®äººå§“å *</label>
                    <input type="text" id="giverName" placeholder="ä¾‹å¦‚: å‘‚å°é’" required>
                </div>
                <div class="form-group">
                    <label>æ”¶ç¦®äººå§“å *</label>
                    <input type="text" id="recipientName" placeholder="ä¾‹å¦‚: é™³é˜¿å¬¤ã€æä¼¯ä¼¯" required>
                </div>
                <div class="form-group">
                    <label>ç´…åŒ…é‡‘é¡ (å…ƒ) *</label>
                    <input type="number" id="amount" placeholder="ä¾‹å¦‚: 2000" min="0" required>
                    <div class="amount-templates">
                        <button type="button" class="btn-template" onclick="setAmount(600)">600</button>
                        <button type="button" class="btn-template" onclick="setAmount(1000)">1000</button>
                        <button type="button" class="btn-template" onclick="setAmount(1200)">1200</button>
                        <button type="button" class="btn-template" onclick="setAmount(1600)">1600</button>
                        <button type="button" class="btn-template" onclick="setAmount(2000)">2000</button>
                        <button type="button" class="btn-template" onclick="setAmount(2600)">2600</button>
                        <button type="button" class="btn-template" onclick="setAmount(3600)">3600</button>
                        <button type="button" class="btn-template" onclick="setAmount(6000)">6000</button>
                    </div>
                </div>
                <button class="btn-add" onclick="addRecipient()">â• æ–°å¢</button>
            </div>

            <div class="denomination-section">
                <div class="section-title">ğŸ’µ æŒ‡å®šç´™éˆ”å¼µæ•¸ (é¸å¡«)</div>
                <div class="denomination-help-text">ğŸ’¡ èªªæ˜: è‡ªå‹•è¨ˆç®—æœƒå„ªå…ˆä½¿ç”¨ 1000ã€500ã€100 å…ƒç­‰å¸¸ç”¨é¢é¡</div>
                <div class="denomination-group">
                    <div class="denomination-item">
                        <input type="number" id="denom1000" min="0" placeholder="0" oninput="updateSubtotal()">
                        <label>1000å…ƒ â­</label>
                    </div>
                    <div class="denomination-item">
                        <input type="number" id="denom500" min="0" placeholder="0" oninput="updateSubtotal()">
                        <label>500å…ƒ â­</label>
                    </div>
                    <div class="denomination-item">
                        <input type="number" id="denom100" min="0" placeholder="0" oninput="updateSubtotal()">
                        <label>100å…ƒ â­</label>
                    </div>
                    <div class="denomination-item">
                        <input type="number" id="denom2000" min="0" placeholder="0" oninput="updateSubtotal()">
                        <label>2000å…ƒ</label>
                    </div>
                    <div class="denomination-item">
                        <input type="number" id="denom200" min="0" placeholder="0" oninput="updateSubtotal()">
                        <label>200å…ƒ</label>
                    </div>
                </div>
            </div>

            <div class="denomination-section">
                <div class="section-title">ğŸª™ æŒ‡å®šç¡¬å¹£æ•¸é‡ (é¸å¡«)</div>
                <div class="denomination-group">
                    <div class="denomination-item">
                        <input type="number" id="denom50" min="0" placeholder="0" oninput="updateSubtotal()">
                        <label>50å…ƒ</label>
                    </div>
                    <div class="denomination-item">
                        <input type="number" id="denom10" min="0" placeholder="0" oninput="updateSubtotal()">
                        <label>10å…ƒ</label>
                    </div>
                    <div class="denomination-item">
                        <input type="number" id="denom5" min="0" placeholder="0" oninput="updateSubtotal()">
                        <label>5å…ƒ</label>
                    </div>
                    <div class="denomination-item">
                        <input type="number" id="denom1" min="0" placeholder="0" oninput="updateSubtotal()">
                        <label>1å…ƒ</label>
                    </div>
                </div>
            </div>

            <div class="subtotal-container">
                <div class="subtotal-display" id="subtotalDisplay">
                    <div class="subtotal-label">ğŸ’° æŒ‡å®šé¢é¡å°è¨ˆ</div>
                    <div class="subtotal-amount" id="subtotalAmount">NT$ 0</div>
                </div>
                <button class="btn-use-subtotal" onclick="useSubtotalAsAmount()" id="useSubtotalBtn" disabled>
                    â¬†ï¸ ä½¿ç”¨æ­¤é‡‘é¡
                </button>
            </div>
        </div>

        <div class="search-filter-section">
            <h3 style="margin-bottom: 15px; color: #495057;">ğŸ” æœå°‹èˆ‡ç¯©é¸</h3>
            <div class="search-filter-controls">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="æœå°‹é€ç¦®äººæˆ–æ”¶ç¦®äºº..." oninput="filterRecipients()">
                </div>
                <div class="filter-buttons">
                    <button class="btn-filter" onclick="sortRecipients('giver')">ğŸ“¤ é€ç¦®äººæ’åº</button>
                    <button class="btn-filter" onclick="sortRecipients('recipient')">ğŸ“¥ æ”¶ç¦®äººæ’åº</button>
                    <button class="btn-filter" onclick="sortRecipients('amount')">ğŸ’° é‡‘é¡æ’åº</button>
                    <button class="btn-filter active" onclick="resetFilter()">ğŸ”„ é‡ç½®</button>
                </div>
            </div>
        </div>

        <div class="recipient-list" id="recipientList">
            <div class="empty-state">å°šæœªæ–°å¢ä»»ä½•ç´…åŒ…,è«‹åœ¨ä¸Šæ–¹æ–°å¢</div>
        </div>

        <div class="naming-reminder">
            <div class="reminder-icon">âš ï¸</div>
            <div class="reminder-content">
                <div class="reminder-title">ç¨±è¬‚æé†’</div>
                <div class="reminder-text">
                    è«‹æ³¨æ„ç¨±è¬‚çš„æ­£ç¢ºæ€§èˆ‡é—œä¿‚æ€§,å»ºè­°ä½¿ç”¨å…·é«”å§“åæˆ–ç¶½è™Ÿä»£è¡¨,ä»¥å…ç¨±è¬‚ç›¸åŒé€ æˆçµ±è¨ˆéŒ¯èª¤ã€‚ä¾‹å¦‚:å¤šä½é€ç¦®äººéƒ½å¡«ã€Œåª½åª½ã€ä½œç‚ºæ”¶ç¦®äºº,ç³»çµ±æœƒè¦–ç‚ºåŒä¸€äººè€Œåˆä½µçµ±è¨ˆã€‚
                </div>
            </div>
        </div>

        <div class="privacy-notice">
            <div class="privacy-icon">ğŸ”’</div>
            <div class="privacy-content">
                <div class="privacy-title">éš±ç§ä¿è­‰</div>
                <div class="privacy-text">
                    æ‚¨çš„è³‡æ–™åƒ…å„²å­˜åœ¨<strong>æ‚¨çš„è£ç½®</strong>ä¸Š,ä¸æœƒä¸Šå‚³åˆ°ä»»ä½•ä¼ºæœå™¨ã€‚å…¶ä»–äººæˆ–å…¶ä»–è£ç½®å®Œå…¨ç„¡æ³•å­˜å–æ‚¨çš„è³‡æ–™,è«‹æ”¾å¿ƒä½¿ç”¨ã€‚
                </div>
            </div>
        </div>

        <div class="summary-section" id="recipientSummary" style="display: none;">
            <div class="summary-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å„æ”¶ç¦®äººçµ±è¨ˆ</div>
            <div id="recipientSummaryContent"></div>
        </div>

        <div class="summary-section" id="giverSummary" style="display: none;">
            <div class="summary-title">ğŸ‘¤ å„é€ç¦®äººæ›éˆ”çµ±è¨ˆ</div>
            <div id="giverSummaryContent"></div>
        </div>

        <div class="summary-section" id="summary" style="display: none;">
            <div class="summary-title">ğŸ“Š ç¸½è¨ˆ - éœ€è¦å…Œæ›çš„æ–°éˆ”/ç¡¬å¹£çµ±è¨ˆ</div>
            
            <div class="summary-categories">
                <div class="category-section" id="billSection" style="display: none;">
                    <div class="category-title">ğŸ’µ ç´™éˆ”</div>
                    <div class="summary-grid" id="billGrid"></div>
                </div>
                
                <div class="category-section" id="coinSection" style="display: none;">
                    <div class="category-title">ğŸª™ ç¡¬å¹£</div>
                    <div class="summary-grid" id="coinGrid"></div>
                </div>
            </div>

            <div class="summary-total">
                <div class="total-label">ç´…åŒ…ç¸½é‡‘é¡</div>
                <div class="total-amount" id="totalAmount">NT$ 0</div>
            </div>

            <div class="export-buttons">
                <button class="btn-export btn-export-text" onclick="exportAsText()">
                    ğŸ“‹ åŒ¯å‡ºç´”æ–‡å­—
                </button>
                <button class="btn-export btn-export-excel" onclick="exportAsExcel()">
                    ğŸ“Š åŒ¯å‡ºExcel
                </button>
                <button class="btn-export btn-export-print" onclick="printSummary()">
                    ğŸ–¨ï¸ åˆ—å°çµ±è¨ˆ
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let recipients = [];

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥å„²å­˜çš„è³‡æ–™
        window.addEventListener('DOMContentLoaded', function() {
            autoLoadData();
        });

        // è‡ªå‹•è¼‰å…¥è³‡æ–™
        function autoLoadData() {
            try {
                const saved = localStorage.getItem('redEnvelopeData');
                if (saved) {
                    const data = JSON.parse(saved);
                    recipients = data.recipients || [];
                    if (recipients.length > 0) {
                        renderRecipients();
                        renderRecipientSummary();
                        renderGiverSummary();
                        renderSummary();
                        updateDataCount();
                        console.log('å·²è‡ªå‹•è¼‰å…¥å„²å­˜çš„è³‡æ–™');
                    }
                }
            } catch (error) {
                console.error('è‡ªå‹•è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
            }
        }

        // å„²å­˜è³‡æ–™åˆ° localStorage
        function saveData() {
            try {
                const data = {
                    recipients: recipients,
                    savedAt: new Date().toISOString()
                };
                localStorage.setItem('redEnvelopeData', JSON.stringify(data));
                alert('âœ… è³‡æ–™å·²å„²å­˜!\n\nä¸‹æ¬¡é–‹å•Ÿé é¢æœƒè‡ªå‹•è¼‰å…¥ã€‚');
            } catch (error) {
                console.error('å„²å­˜å¤±æ•—:', error);
                alert('âŒ å„²å­˜å¤±æ•—,è«‹ç¨å¾Œå†è©¦ã€‚');
            }
        }

        // è¼‰å…¥è³‡æ–™
        function loadData() {
            try {
                const saved = localStorage.getItem('redEnvelopeData');
                if (!saved) {
                    alert('ğŸ“­ æ²’æœ‰æ‰¾åˆ°å·²å„²å­˜çš„è³‡æ–™ã€‚');
                    return;
                }

                const data = JSON.parse(saved);
                const savedTime = new Date(data.savedAt).toLocaleString('zh-TW');
                
                if (confirm(`ç™¼ç¾å„²å­˜çš„è³‡æ–™:\nå„²å­˜æ™‚é–“: ${savedTime}\nå…± ${data.recipients.length} ç­†ç´…åŒ…è¨˜éŒ„\n\næ˜¯å¦è¼‰å…¥? (æœƒè¦†è“‹ç›®å‰è³‡æ–™)`)) {
                    recipients = data.recipients || [];
                    renderRecipients();
                    renderRecipientSummary();
                    renderGiverSummary();
                    renderSummary();
                    updateDataCount();
                    alert('âœ… è³‡æ–™å·²è¼‰å…¥!');
                }
            } catch (error) {
                console.error('è¼‰å…¥å¤±æ•—:', error);
                alert('âŒ è¼‰å…¥å¤±æ•—,è³‡æ–™å¯èƒ½å·²æå£ã€‚');
            }
        }

        // æ¸…é™¤å„²å­˜çš„è³‡æ–™
        function clearStorage() {
            if (confirm('âš ï¸ ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å·²å„²å­˜çš„è³‡æ–™å—?\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸ!')) {
                try {
                    localStorage.removeItem('redEnvelopeData');
                    alert('âœ… å·²æ¸…é™¤å„²å­˜çš„è³‡æ–™ã€‚');
                } catch (error) {
                    console.error('æ¸…é™¤å¤±æ•—:', error);
                    alert('âŒ æ¸…é™¤å¤±æ•—ã€‚');
                }
            }
        }

        // åŒ¯å‡ºç´”æ–‡å­—
        function exportAsText() {
            if (recipients.length === 0) {
                alert('âš ï¸ ç›®å‰æ²’æœ‰ä»»ä½•ç´…åŒ…è³‡æ–™å¯ä»¥åŒ¯å‡ºã€‚');
                return;
            }

            // è¨ˆç®—ç¸½è¨ˆ
            const totals = { 2000: 0, 1000: 0, 500: 0, 200: 0, 100: 0, 50: 0, 10: 0, 5: 0, 1: 0 };
            let totalAmount = 0;

            recipients.forEach(recipient => {
                totalAmount += recipient.amount;
                Object.entries(recipient.denominations).forEach(([denom, count]) => {
                    totals[denom] += count;
                });
            });

            // ç”Ÿæˆæ–‡å­—
            let text = 'ğŸ§§ è¾²æ›†æ–°å¹´ç´…åŒ…æ›æ–°éˆ”çµ±è¨ˆ ğŸ§§\n';
            text += '=' .repeat(40) + '\n\n';
            text += `ğŸ“… åŒ¯å‡ºæ™‚é–“: ${new Date().toLocaleString('zh-TW')}\n`;
            text += `ğŸ“Š ç´…åŒ…ç¸½æ•¸: ${recipients.length} å€‹\n`;
            text += `ğŸ’° ç¸½é‡‘é¡: NT$ ${totalAmount.toLocaleString()}\n\n`;
            text += '=' .repeat(40) + '\n';
            text += 'ğŸ’µ éœ€è¦å…Œæ›çš„æ–°éˆ”/ç¡¬å¹£çµ±è¨ˆ\n';
            text += '=' .repeat(40) + '\n\n';

            // ç´™éˆ”
            const bills = Object.entries(totals)
                .filter(([denom, _]) => parseInt(denom) >= 100)
                .filter(([_, count]) => count > 0);

            if (bills.length > 0) {
                text += 'ã€ç´™éˆ”ã€‘\n';
                bills.forEach(([denom, count]) => {
                    text += `  ${denom} å…ƒ Ã— ${count} å¼µ\n`;
                });
                text += '\n';
            }

            // ç¡¬å¹£
            const coins = Object.entries(totals)
                .filter(([denom, _]) => parseInt(denom) < 100)
                .filter(([_, count]) => count > 0);

            if (coins.length > 0) {
                text += 'ã€ç¡¬å¹£ã€‘\n';
                coins.forEach(([denom, count]) => {
                    text += `  ${denom} å…ƒ Ã— ${count} æš\n`;
                });
                text += '\n';
            }

            text += '=' .repeat(40) + '\n';
            text += 'å”ä½œè€…: Ching & Claude\n';
            text += 'å·¥å…·: è¾²æ›†æ–°å¹´ç´…åŒ…æ›æ–°éˆ”è¨ˆç®—å™¨\n';

            // è¤‡è£½åˆ°å‰ªè²¼ç°¿
            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿!\n\nå¯ä»¥ç›´æ¥è²¼åˆ° LINEã€Email æˆ–è¨˜äº‹æœ¬ã€‚');
            }).catch(() => {
                // å¦‚æœè¤‡è£½å¤±æ•—,é¡¯ç¤ºæ–‡å­—è®“ä½¿ç”¨è€…æ‰‹å‹•è¤‡è£½
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿!');
                } catch (err) {
                    alert('æ–‡å­—å…§å®¹:\n\n' + text);
                }
                document.body.removeChild(textarea);
            });
        }

        // åŒ¯å‡ºExcel
        function exportAsExcel() {
            if (recipients.length === 0) {
                alert('âš ï¸ ç›®å‰æ²’æœ‰ä»»ä½•ç´…åŒ…è³‡æ–™å¯ä»¥åŒ¯å‡ºã€‚');
                return;
            }

            // å»ºç«‹å·¥ä½œç°¿
            const wb = XLSX.utils.book_new();

            // å·¥ä½œè¡¨1: ç´…åŒ…æ˜ç´°
            const detailData = [
                ['è¾²æ›†æ–°å¹´ç´…åŒ…æ˜ç´°è¡¨'],
                ['åŒ¯å‡ºæ™‚é–“', new Date().toLocaleString('zh-TW')],
                [],
                ['é€ç¦®äºº', 'æ”¶ç¦®äºº', 'é‡‘é¡', '2000å…ƒ', '1000å…ƒ', '500å…ƒ', '200å…ƒ', '100å…ƒ', '50å…ƒ', '10å…ƒ', '5å…ƒ', '1å…ƒ']
            ];

            recipients.forEach(r => {
                detailData.push([
                    r.giverName,
                    r.recipientName,
                    r.amount,
                    r.denominations[2000] || 0,
                    r.denominations[1000] || 0,
                    r.denominations[500] || 0,
                    r.denominations[200] || 0,
                    r.denominations[100] || 0,
                    r.denominations[50] || 0,
                    r.denominations[10] || 0,
                    r.denominations[5] || 0,
                    r.denominations[1] || 0
                ]);
            });

            const ws1 = XLSX.utils.aoa_to_sheet(detailData);
            XLSX.utils.book_append_sheet(wb, ws1, 'ç´…åŒ…æ˜ç´°');

            // å·¥ä½œè¡¨2: é€ç¦®äººçµ±è¨ˆ
            const giverStats = {};
            recipients.forEach(r => {
                if (!giverStats[r.giverName]) {
                    giverStats[r.giverName] = {
                        totalAmount: 0,
                        denominations: { 2000: 0, 1000: 0, 500: 0, 200: 0, 100: 0, 50: 0, 10: 0, 5: 0, 1: 0 }
                    };
                }
                giverStats[r.giverName].totalAmount += r.amount;
                Object.entries(r.denominations).forEach(([denom, count]) => {
                    giverStats[r.giverName].denominations[denom] += count;
                });
            });

            const giverData = [
                ['é€ç¦®äººçµ±è¨ˆ'],
                [],
                ['é€ç¦®äºº', 'ç¸½é‡‘é¡', '2000å…ƒ', '1000å…ƒ', '500å…ƒ', '200å…ƒ', '100å…ƒ', '50å…ƒ', '10å…ƒ', '5å…ƒ', '1å…ƒ']
            ];

            Object.entries(giverStats).forEach(([name, stats]) => {
                giverData.push([
                    name,
                    stats.totalAmount,
                    stats.denominations[2000] || 0,
                    stats.denominations[1000] || 0,
                    stats.denominations[500] || 0,
                    stats.denominations[200] || 0,
                    stats.denominations[100] || 0,
                    stats.denominations[50] || 0,
                    stats.denominations[10] || 0,
                    stats.denominations[5] || 0,
                    stats.denominations[1] || 0
                ]);
            });

            const ws2 = XLSX.utils.aoa_to_sheet(giverData);
            XLSX.utils.book_append_sheet(wb, ws2, 'é€ç¦®äººçµ±è¨ˆ');

            // å·¥ä½œè¡¨3: æ”¶ç¦®äººçµ±è¨ˆ
            const recipientStats = {};
            recipients.forEach(r => {
                if (!recipientStats[r.recipientName]) {
                    recipientStats[r.recipientName] = {
                        totalAmount: 0,
                        denominations: { 2000: 0, 1000: 0, 500: 0, 200: 0, 100: 0, 50: 0, 10: 0, 5: 0, 1: 0 }
                    };
                }
                recipientStats[r.recipientName].totalAmount += r.amount;
                Object.entries(r.denominations).forEach(([denom, count]) => {
                    recipientStats[r.recipientName].denominations[denom] += count;
                });
            });

            const recipientData = [
                ['æ”¶ç¦®äººçµ±è¨ˆ'],
                [],
                ['æ”¶ç¦®äºº', 'ç¸½é‡‘é¡', '2000å…ƒ', '1000å…ƒ', '500å…ƒ', '200å…ƒ', '100å…ƒ', '50å…ƒ', '10å…ƒ', '5å…ƒ', '1å…ƒ']
            ];

            Object.entries(recipientStats).forEach(([name, stats]) => {
                recipientData.push([
                    name,
                    stats.totalAmount,
                    stats.denominations[2000] || 0,
                    stats.denominations[1000] || 0,
                    stats.denominations[500] || 0,
                    stats.denominations[200] || 0,
                    stats.denominations[100] || 0,
                    stats.denominations[50] || 0,
                    stats.denominations[10] || 0,
                    stats.denominations[5] || 0,
                    stats.denominations[1] || 0
                ]);
            });

            const ws3 = XLSX.utils.aoa_to_sheet(recipientData);
            XLSX.utils.book_append_sheet(wb, ws3, 'æ”¶ç¦®äººçµ±è¨ˆ');

            // å·¥ä½œè¡¨4: ç¸½è¨ˆçµ±è¨ˆ
            const totals = { 2000: 0, 1000: 0, 500: 0, 200: 0, 100: 0, 50: 0, 10: 0, 5: 0, 1: 0 };
            let totalAmount = 0;

            recipients.forEach(r => {
                totalAmount += r.amount;
                Object.entries(r.denominations).forEach(([denom, count]) => {
                    totals[denom] += count;
                });
            });

            const summaryData = [
                ['ç¸½è¨ˆçµ±è¨ˆ'],
                ['ç´…åŒ…ç¸½æ•¸', recipients.length],
                ['ç´…åŒ…ç¸½é‡‘é¡', totalAmount],
                [],
                ['é¢é¡', 'æ•¸é‡', 'å–®ä½', 'å°è¨ˆ']
            ];

            Object.entries(totals).forEach(([denom, count]) => {
                if (count > 0) {
                    const unit = parseInt(denom) >= 100 ? 'å¼µ' : 'æš';
                    summaryData.push([
                        `${denom}å…ƒ`,
                        count,
                        unit,
                        parseInt(denom) * count
                    ]);
                }
            });

            const ws4 = XLSX.utils.aoa_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, ws4, 'ç¸½è¨ˆçµ±è¨ˆ');

            // ä¸‹è¼‰æª”æ¡ˆ
            const filename = `ç´…åŒ…æ›éˆ”çµ±è¨ˆ_${new Date().toISOString().slice(0,10)}.xlsx`;
            XLSX.writeFile(wb, filename);
        }

        // å³æ™‚æ›´æ–°æŒ‡å®šé¢é¡å°è¨ˆ
        function updateSubtotal() {
            const subtotal = 
                (parseInt(document.getElementById('denom2000').value) || 0) * 2000 +
                (parseInt(document.getElementById('denom1000').value) || 0) * 1000 +
                (parseInt(document.getElementById('denom500').value) || 0) * 500 +
                (parseInt(document.getElementById('denom200').value) || 0) * 200 +
                (parseInt(document.getElementById('denom100').value) || 0) * 100 +
                (parseInt(document.getElementById('denom50').value) || 0) * 50 +
                (parseInt(document.getElementById('denom10').value) || 0) * 10 +
                (parseInt(document.getElementById('denom5').value) || 0) * 5 +
                (parseInt(document.getElementById('denom1').value) || 0) * 1;

            document.getElementById('subtotalAmount').textContent = `NT$ ${subtotal.toLocaleString()}`;
            
            // å•Ÿç”¨/åœç”¨ã€Œä½¿ç”¨æ­¤é‡‘é¡ã€æŒ‰éˆ•
            const useBtn = document.getElementById('useSubtotalBtn');
            if (subtotal > 0) {
                useBtn.disabled = false;
            } else {
                useBtn.disabled = true;
            }
        }

        // ä½¿ç”¨å°è¨ˆé‡‘é¡ä½œç‚ºç´…åŒ…é‡‘é¡
        function useSubtotalAsAmount() {
            const subtotal = 
                (parseInt(document.getElementById('denom2000').value) || 0) * 2000 +
                (parseInt(document.getElementById('denom1000').value) || 0) * 1000 +
                (parseInt(document.getElementById('denom500').value) || 0) * 500 +
                (parseInt(document.getElementById('denom200').value) || 0) * 200 +
                (parseInt(document.getElementById('denom100').value) || 0) * 100 +
                (parseInt(document.getElementById('denom50').value) || 0) * 50 +
                (parseInt(document.getElementById('denom10').value) || 0) * 10 +
                (parseInt(document.getElementById('denom5').value) || 0) * 5 +
                (parseInt(document.getElementById('denom1').value) || 0) * 1;

            if (subtotal > 0) {
                document.getElementById('amount').value = subtotal;
                // è‡ªå‹•è§¸ç™¼æ–°å¢
                addRecipient();
            }
        }

        function addRecipient() {
            const giverName = document.getElementById('giverName').value.trim();
            const recipientName = document.getElementById('recipientName').value.trim();
            const amount = parseInt(document.getElementById('amount').value);

            // è¡¨å–®é©—è­‰
            if (!giverName) {
                alert('âš ï¸ è«‹è¼¸å…¥é€ç¦®äººå§“å');
                document.getElementById('giverName').focus();
                return;
            }

            if (!recipientName) {
                alert('âš ï¸ è«‹è¼¸å…¥æ”¶ç¦®äººå§“å');
                document.getElementById('recipientName').focus();
                return;
            }

            if (!amount || amount <= 0) {
                alert('âš ï¸ è«‹è¼¸å…¥æœ‰æ•ˆçš„ç´…åŒ…é‡‘é¡');
                document.getElementById('amount').focus();
                return;
            }

            // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„é€ç¦®äºº+æ”¶ç¦®äººçµ„åˆ
            const existingIndex = recipients.findIndex(r => 
                r.giverName === giverName && r.recipientName === recipientName
            );

            if (existingIndex !== -1) {
                const existingAmount = recipients[existingIndex].amount;
                const confirmMessage = `âš ï¸ è­¦å‘Š:\n\né€ç¦®äººã€Œ${giverName}ã€å·²ç¶“æœ‰çµ¦ã€Œ${recipientName}ã€çš„ç´…åŒ…è¨˜éŒ„äº†!\nåŸé‡‘é¡: NT$ ${existingAmount.toLocaleString()}\næ–°é‡‘é¡: NT$ ${amount.toLocaleString()}\n\næ˜¯å¦è¦æ–°å¢é€™ç­†é‡è¤‡çš„ç´…åŒ…è¨˜éŒ„?`;
                
                if (!confirm(confirmMessage)) {
                    return; // ä½¿ç”¨è€…é¸æ“‡å–æ¶ˆ
                }
            }

            // å–å¾—æŒ‡å®šé¢é¡
            const customDenoms = {
                2000: parseInt(document.getElementById('denom2000').value) || 0,
                1000: parseInt(document.getElementById('denom1000').value) || 0,
                500: parseInt(document.getElementById('denom500').value) || 0,
                200: parseInt(document.getElementById('denom200').value) || 0,
                100: parseInt(document.getElementById('denom100').value) || 0,
                50: parseInt(document.getElementById('denom50').value) || 0,
                10: parseInt(document.getElementById('denom10').value) || 0,
                5: parseInt(document.getElementById('denom5').value) || 0,
                1: parseInt(document.getElementById('denom1').value) || 0
            };

            // æª¢æŸ¥æŒ‡å®šé¢é¡æ˜¯å¦ç¬¦åˆé‡‘é¡
            const customTotal = customDenoms[2000] * 2000 + customDenoms[1000] * 1000 + 
                              customDenoms[500] * 500 + customDenoms[200] * 200 + 
                              customDenoms[100] * 100 + customDenoms[50] * 50 +
                              customDenoms[10] * 10 + customDenoms[5] * 5 + 
                              customDenoms[1] * 1;

            let denominations;
            if (customTotal > 0) {
                if (customTotal !== amount) {
                    alert(`æŒ‡å®šçš„é¢é¡ç¸½å’Œ (${customTotal}å…ƒ) èˆ‡ç´…åŒ…é‡‘é¡ (${amount}å…ƒ) ä¸ç¬¦!`);
                    return;
                }
                denominations = customDenoms;
            } else {
                // è‡ªå‹•è¨ˆç®—æœ€ä½³é¢é¡çµ„åˆ
                denominations = calculateDenominations(amount);
            }

            recipients.push({
                giverName,
                recipientName,
                amount,
                denominations
            });

            // æ¸…ç©ºè¼¸å…¥æ¬„ä½
            document.getElementById('giverName').value = '';
            document.getElementById('recipientName').value = '';
            document.getElementById('amount').value = '';
            document.getElementById('denom2000').value = '';
            document.getElementById('denom1000').value = '';
            document.getElementById('denom500').value = '';
            document.getElementById('denom200').value = '';
            document.getElementById('denom100').value = '';
            document.getElementById('denom50').value = '';
            document.getElementById('denom10').value = '';
            document.getElementById('denom5').value = '';
            document.getElementById('denom1').value = '';
            
            // æ¸…ç©ºå°è¨ˆ
            updateSubtotal();

            renderRecipients();
            renderRecipientSummary();
            renderGiverSummary();
            renderSummary();
            updateDataCount();
        }

        function calculateDenominations(amount) {
            const denoms = { 2000: 0, 1000: 0, 500: 0, 200: 0, 100: 0, 50: 0, 10: 0, 5: 0, 1: 0 };
            let remaining = amount;

            // å°ç£å¸¸ç”¨é¢é¡å„ªå…ˆç­–ç•¥:
            // å„ªå…ˆä½¿ç”¨: 1000ã€500ã€100 (å¸‚é¢æµé€šå»£)
            // é¿å…ä½¿ç”¨: 2000ã€200 (è¼ƒå°‘æµé€š)

            // å…ˆç”¨1000å…ƒ (æœ€å¸¸è¦‹å¤§éˆ”)
            denoms[1000] = Math.floor(remaining / 1000);
            remaining %= 1000;

            // å†ç”¨500å…ƒ (å¸¸è¦‹ä¸­é¡)
            denoms[500] = Math.floor(remaining / 500);
            remaining %= 500;

            // æ¥è‘—ç”¨100å…ƒ (æœ€å¸¸è¦‹å°éˆ”)
            denoms[100] = Math.floor(remaining / 100);
            remaining %= 100;

            // æœ€å¾Œæ‰ç”¨ç¡¬å¹£
            denoms[50] = Math.floor(remaining / 50);
            remaining %= 50;

            denoms[10] = Math.floor(remaining / 10);
            remaining %= 10;

            denoms[5] = Math.floor(remaining / 5);
            remaining %= 5;

            denoms[1] = remaining;

            // 2000å…ƒå’Œ200å…ƒä¿æŒç‚º0 (ä¸è‡ªå‹•ä½¿ç”¨)
            // ä½¿ç”¨è€…å¯æ‰‹å‹•æŒ‡å®šé€™äº›é¢é¡

            return denoms;
        }

        // è¨­å®šé‡‘é¡ç¯„æœ¬
        function setAmount(amount) {
            document.getElementById('amount').value = amount;
            document.getElementById('amount').focus();
        }

        // å¿«é€Ÿè¤‡è£½ç´…åŒ…
        function copyRecipient(index) {
            const original = recipients[index];
            document.getElementById('giverName').value = original.giverName;
            document.getElementById('recipientName').value = original.recipientName;
            document.getElementById('amount').value = original.amount;
            
            // æ²å‹•åˆ°è¼¸å…¥å€åŸŸ
            document.querySelector('.input-section').scrollIntoView({ behavior: 'smooth' });
            
            // æç¤ºä½¿ç”¨è€…
            setTimeout(() => {
                alert('âœ… å·²è¤‡è£½è³‡æ–™åˆ°è¼¸å…¥æ¬„ä½!\n\nå¯ä»¥ä¿®æ”¹å¾Œå†æ–°å¢ã€‚');
            }, 300);
        }

        // æœå°‹ç¯©é¸ç´…åŒ…
        let currentFilter = null;
        let currentSort = null;

        function filterRecipients() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            currentFilter = searchText;
            applyFilterAndSort();
        }

        function sortRecipients(type) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.btn-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentSort = type;
            applyFilterAndSort();
        }

        function resetFilter() {
            document.getElementById('searchInput').value = '';
            currentFilter = null;
            currentSort = null;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.btn-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderRecipients();
        }

        function applyFilterAndSort() {
            let filtered = [...recipients];

            // æœå°‹ç¯©é¸
            if (currentFilter) {
                filtered = filtered.filter((r, index) => {
                    r._originalIndex = index; // ä¿å­˜åŸå§‹ç´¢å¼•
                    return r.giverName.toLowerCase().includes(currentFilter) ||
                           r.recipientName.toLowerCase().includes(currentFilter);
                });
            } else {
                filtered.forEach((r, index) => {
                    r._originalIndex = index;
                });
            }

            // æ’åº
            if (currentSort === 'giver') {
                filtered.sort((a, b) => a.giverName.localeCompare(b.giverName, 'zh-TW'));
            } else if (currentSort === 'recipient') {
                filtered.sort((a, b) => a.recipientName.localeCompare(b.recipientName, 'zh-TW'));
            } else if (currentSort === 'amount') {
                filtered.sort((a, b) => b.amount - a.amount);
            }

            // é¡¯ç¤ºçµæœ
            const list = document.getElementById('recipientList');

            if (filtered.length === 0) {
                if (currentFilter) {
                    list.innerHTML = '<div class="empty-state">ğŸ” æ‰¾ä¸åˆ°ç¬¦åˆçš„ç´…åŒ…è³‡æ–™</div>';
                } else {
                    list.innerHTML = '<div class="empty-state">å°šæœªæ–°å¢ä»»ä½•ç´…åŒ…,è«‹åœ¨ä¸Šæ–¹æ–°å¢</div>';
                }
                return;
            }

            list.innerHTML = filtered.map((recipient) => {
                const index = recipient._originalIndex;
                const denomText = Object.entries(recipient.denominations)
                    .filter(([_, count]) => count > 0)
                    .map(([denom, count]) => `${denom}å…ƒÃ—${count}${parseInt(denom) >= 100 ? 'å¼µ' : 'æš'}`)
                    .join(' + ');

                return `
                    <div class="recipient-item">
                        <div class="recipient-info">
                            <div class="info-item">
                                <span class="info-label">é€ç¦®äºº:</span>
                                <span class="info-value">${recipient.giverName}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">æ”¶ç¦®äºº:</span>
                                <span class="info-value">${recipient.recipientName}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">é‡‘é¡:</span>
                                <span class="amount-value">NT$ ${recipient.amount.toLocaleString()}</span>
                            </div>
                            <div class="info-item" style="grid-column: 1 / -1;">
                                <span class="info-label">é¢é¡:</span>
                                <span class="info-value">${denomText}</span>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <button class="btn-copy" onclick="copyRecipient(${index})" title="å¿«é€Ÿè¤‡è£½æ­¤ç­†è³‡æ–™">
                                ğŸ“‹ è¤‡è£½
                            </button>
                            <button class="btn-remove" onclick="removeRecipient(${index})">âŒ åˆªé™¤</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åˆ—å°çµ±è¨ˆ
        function printSummary() {
            if (recipients.length === 0) {
                alert('âš ï¸ ç›®å‰æ²’æœ‰ä»»ä½•ç´…åŒ…è³‡æ–™å¯ä»¥åˆ—å°ã€‚');
                return;
            }

            // è¨ˆç®—ç¸½è¨ˆ
            const totals = { 2000: 0, 1000: 0, 500: 0, 200: 0, 100: 0, 50: 0, 10: 0, 5: 0, 1: 0 };
            let totalAmount = 0;

            recipients.forEach(recipient => {
                totalAmount += recipient.amount;
                Object.entries(recipient.denominations).forEach(([denom, count]) => {
                    totals[denom] += count;
                });
            });

            // ç”Ÿæˆåˆ—å°å…§å®¹
            let printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>ç´…åŒ…æ›æ–°éˆ”çµ±è¨ˆè¡¨</title>
                    <style>
                        body {
                            font-family: "Microsoft JhengHei", Arial, sans-serif;
                            padding: 30px;
                            max-width: 800px;
                            margin: 0 auto;
                        }
                        h1 {
                            text-align: center;
                            color: #c92a2a;
                            border-bottom: 3px solid #c92a2a;
                            padding-bottom: 15px;
                        }
                        .info {
                            margin: 20px 0;
                            font-size: 14px;
                            color: #666;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 20px 0;
                        }
                        th, td {
                            border: 1px solid #ddd;
                            padding: 12px;
                            text-align: center;
                        }
                        th {
                            background: #f8f9fa;
                            font-weight: bold;
                            color: #495057;
                        }
                        .total-row {
                            background: #fff3cd;
                            font-weight: bold;
                        }
                        .summary {
                            background: #e7f5ff;
                            padding: 20px;
                            border-radius: 10px;
                            margin-top: 30px;
                        }
                        .summary h2 {
                            color: #1864ab;
                            margin-top: 0;
                        }
                        .footer {
                            text-align: center;
                            margin-top: 40px;
                            font-size: 12px;
                            color: #868e96;
                        }
                    </style>
                </head>
                <body>
                    <h1>ğŸ§§ è¾²æ›†æ–°å¹´ç´…åŒ…æ›æ–°éˆ”çµ±è¨ˆè¡¨</h1>
                    
                    <div class="info">
                        <p>ğŸ“… åˆ—å°æ™‚é–“: ${new Date().toLocaleString('zh-TW')}</p>
                        <p>ğŸ“Š ç´…åŒ…ç¸½æ•¸: ${recipients.length} å€‹</p>
                        <p>ğŸ’° ç´…åŒ…ç¸½é‡‘é¡: NT$ ${totalAmount.toLocaleString()}</p>
                    </div>

                    <h2>éœ€è¦å…Œæ›çš„æ–°éˆ”/ç¡¬å¹£æ˜ç´°</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>é¢é¡</th>
                                <th>æ•¸é‡</th>
                                <th>å–®ä½</th>
                                <th>å°è¨ˆ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // ç´™éˆ”
            Object.entries(totals)
                .filter(([denom, _]) => parseInt(denom) >= 100)
                .filter(([_, count]) => count > 0)
                .forEach(([denom, count]) => {
                    printContent += `
                        <tr>
                            <td>${denom} å…ƒ</td>
                            <td>${count}</td>
                            <td>å¼µ</td>
                            <td>NT$ ${(parseInt(denom) * count).toLocaleString()}</td>
                        </tr>
                    `;
                });

            // ç¡¬å¹£
            Object.entries(totals)
                .filter(([denom, _]) => parseInt(denom) < 100)
                .filter(([_, count]) => count > 0)
                .forEach(([denom, count]) => {
                    printContent += `
                        <tr>
                            <td>${denom} å…ƒ</td>
                            <td>${count}</td>
                            <td>æš</td>
                            <td>NT$ ${(parseInt(denom) * count).toLocaleString()}</td>
                        </tr>
                    `;
                });

            printContent += `
                            <tr class="total-row">
                                <td colspan="3">ç¸½è¨ˆ</td>
                                <td>NT$ ${totalAmount.toLocaleString()}</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="summary">
                        <h2>ğŸ“ ä½¿ç”¨èªªæ˜</h2>
                        <p>è«‹æ”œå¸¶æ­¤è¡¨æ ¼åˆ°éŠ€è¡Œæ«ƒå°,å‘ŠçŸ¥éœ€è¦å…Œæ›çš„å„é¢é¡æ–°éˆ”/ç¡¬å¹£æ•¸é‡ã€‚</p>
                        <p>å»ºè­°æå‰é ç´„æˆ–é¸æ“‡é›¢å³°æ™‚æ®µå‰å¾€,ä»¥ç¸®çŸ­ç­‰å€™æ™‚é–“ã€‚</p>
                    </div>

                    <div class="footer">
                        <p>å”ä½œè€…: Ching & Claude</p>
                        <p>å·¥å…·: è¾²æ›†æ–°å¹´ç´…åŒ…æ›æ–°éˆ”è¨ˆç®—å™¨</p>
                    </div>
                </body>
                </html>
            `;

            // é–‹å•Ÿåˆ—å°è¦–çª—
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            
            // ç­‰å¾…è¼‰å…¥å®Œæˆå¾Œåˆ—å°
            setTimeout(() => {
                printWindow.print();
            }, 250);
        }

        // æ¸…ç©ºæ‰€æœ‰ç´…åŒ…è³‡æ–™
        function clearAllRecipients() {
            if (recipients.length === 0) {
                alert('ğŸ“­ ç›®å‰æ²’æœ‰ä»»ä½•ç´…åŒ…è³‡æ–™ã€‚');
                return;
            }

            if (confirm(`âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ ${recipients.length} ç­†ç´…åŒ…è³‡æ–™å—?\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸ!\n(å·²å„²å­˜çš„è³‡æ–™ä¸æœƒè¢«æ¸…é™¤)`)) {
                recipients = [];
                renderRecipients();
                renderRecipientSummary();
                renderGiverSummary();
                renderSummary();
                updateDataCount();
                alert('âœ… å·²æ¸…ç©ºæ‰€æœ‰ç´…åŒ…è³‡æ–™ã€‚');
            }
        }

        // æ›´æ–°è³‡æ–™æ•¸é‡é¡¯ç¤º
        function updateDataCount() {
            const countEl = document.getElementById('dataCount');
            if (countEl) {
                countEl.textContent = `å·²æœ‰ ${recipients.length} ç­†`;
            }
        }

        function removeRecipient(index) {
            recipients.splice(index, 1);
            renderRecipients();
            renderRecipientSummary();
            renderGiverSummary();
            renderSummary();
            updateDataCount();
        }

        function renderRecipients() {
            const list = document.getElementById('recipientList');

            if (recipients.length === 0) {
                list.innerHTML = '<div class="empty-state">å°šæœªæ–°å¢ä»»ä½•ç´…åŒ…,è«‹åœ¨ä¸Šæ–¹æ–°å¢</div>';
                return;
            }

            list.innerHTML = recipients.map((recipient, index) => {
                const denomText = Object.entries(recipient.denominations)
                    .filter(([_, count]) => count > 0)
                    .map(([denom, count]) => `${denom}å…ƒÃ—${count}${parseInt(denom) >= 100 ? 'å¼µ' : 'æš'}`)
                    .join(' + ');

                return `
                    <div class="recipient-item">
                        <div class="recipient-info">
                            <div class="info-item">
                                <span class="info-label">é€ç¦®äºº:</span>
                                <span class="info-value">${recipient.giverName}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">æ”¶ç¦®äºº:</span>
                                <span class="info-value">${recipient.recipientName}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">é‡‘é¡:</span>
                                <span class="amount-value">NT$ ${recipient.amount.toLocaleString()}</span>
                            </div>
                            <div class="info-item" style="grid-column: 1 / -1;">
                                <span class="info-label">é¢é¡:</span>
                                <span class="info-value">${denomText}</span>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <button class="btn-copy" onclick="copyRecipient(${index})" title="å¿«é€Ÿè¤‡è£½æ­¤ç­†è³‡æ–™">
                                ğŸ“‹ è¤‡è£½
                            </button>
                            <button class="btn-remove" onclick="removeRecipient(${index})">âŒ åˆªé™¤</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderRecipientSummary() {
            const recipientSummary = document.getElementById('recipientSummary');
            const recipientSummaryContent = document.getElementById('recipientSummaryContent');

            if (recipients.length === 0) {
                recipientSummary.style.display = 'none';
                return;
            }

            recipientSummary.style.display = 'block';

            // æŒ‰æ”¶ç¦®äººåˆ†çµ„çµ±è¨ˆ
            const recipientStats = {};
            
            recipients.forEach(recipient => {
                if (!recipientStats[recipient.recipientName]) {
                    recipientStats[recipient.recipientName] = {
                        totalAmount: 0,
                        denominations: { 2000: 0, 1000: 0, 500: 0, 200: 0, 100: 0, 50: 0, 10: 0, 5: 0, 1: 0 },
                        giverDetails: {}
                    };
                }
                
                recipientStats[recipient.recipientName].totalAmount += recipient.amount;
                
                // ç´¯è¨ˆé€ç¦®äººé‡‘é¡
                if (!recipientStats[recipient.recipientName].giverDetails[recipient.giverName]) {
                    recipientStats[recipient.recipientName].giverDetails[recipient.giverName] = 0;
                }
                recipientStats[recipient.recipientName].giverDetails[recipient.giverName] += recipient.amount;
                
                Object.entries(recipient.denominations).forEach(([denom, count]) => {
                    recipientStats[recipient.recipientName].denominations[denom] += count;
                });
            });

            // ç”Ÿæˆæ¯å€‹æ”¶ç¦®äººçš„çµ±è¨ˆå¡ç‰‡
            recipientSummaryContent.innerHTML = Object.entries(recipientStats).map(([recipientName, stats]) => {
                // ç”Ÿæˆé€ç¦®äººæ˜ç´°
                const giverSummaryHTML = Object.entries(stats.giverDetails)
                    .map(([giverName, amount]) => `
                        <div class="giver-summary">
                            â† <span class="giver-summary-name">${giverName}</span> 
                            <span class="giver-summary-amount">NT$ ${amount.toLocaleString()}</span>
                        </div>
                    `).join('');

                const bills = Object.entries(stats.denominations)
                    .filter(([denom, _]) => parseInt(denom) >= 100)
                    .filter(([_, count]) => count > 0);

                const coins = Object.entries(stats.denominations)
                    .filter(([denom, _]) => parseInt(denom) < 100)
                    .filter(([_, count]) => count > 0);

                let billsHTML = '';
                if (bills.length > 0) {
                    billsHTML = `
                        <div class="recipient-bill-section">
                            <div class="recipient-category-title">ğŸ’µ ç´™éˆ”</div>
                            <div class="recipient-grid">
                                ${bills.map(([denom, count]) => `
                                    <div class="recipient-denom-item">
                                        <div class="recipient-denom-label">${denom}å…ƒ</div>
                                        <div class="recipient-denom-count">${count}å¼µ</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                let coinsHTML = '';
                if (coins.length > 0) {
                    coinsHTML = `
                        <div class="recipient-coin-section">
                            <div class="recipient-category-title">ğŸª™ ç¡¬å¹£</div>
                            <div class="recipient-grid">
                                ${coins.map(([denom, count]) => `
                                    <div class="recipient-denom-item">
                                        <div class="recipient-denom-label">${denom}å…ƒ</div>
                                        <div class="recipient-denom-count">${count}æš</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="recipient-card">
                        <div class="recipient-name">ğŸ ${recipientName}</div>
                        <div class="recipient-givers">
                            <div class="recipient-givers-title">ğŸ“‹ ç´…åŒ…ä¾†æº</div>
                            ${giverSummaryHTML}
                        </div>
                        <div class="recipient-stats">
                            ${billsHTML}
                            ${coinsHTML}
                        </div>
                        <div class="recipient-total">
                            <div class="recipient-total-label">æ­¤äººæ”¶åˆ°ç¸½é¡</div>
                            <div class="recipient-total-amount">NT$ ${stats.totalAmount.toLocaleString()}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderGiverSummary() {
            const giverSummary = document.getElementById('giverSummary');
            const giverSummaryContent = document.getElementById('giverSummaryContent');

            if (recipients.length === 0) {
                giverSummary.style.display = 'none';
                return;
            }

            giverSummary.style.display = 'block';

            // æŒ‰é€ç¦®äººåˆ†çµ„çµ±è¨ˆ
            const giverStats = {};
            
            recipients.forEach(recipient => {
                if (!giverStats[recipient.giverName]) {
                    giverStats[recipient.giverName] = {
                        totalAmount: 0,
                        denominations: { 2000: 0, 1000: 0, 500: 0, 200: 0, 100: 0, 50: 0, 10: 0, 5: 0, 1: 0 },
                        recipientDetails: {}
                    };
                }
                
                giverStats[recipient.giverName].totalAmount += recipient.amount;
                
                // ç´¯è¨ˆæ”¶ç¦®äººé‡‘é¡
                if (!giverStats[recipient.giverName].recipientDetails[recipient.recipientName]) {
                    giverStats[recipient.giverName].recipientDetails[recipient.recipientName] = 0;
                }
                giverStats[recipient.giverName].recipientDetails[recipient.recipientName] += recipient.amount;
                
                Object.entries(recipient.denominations).forEach(([denom, count]) => {
                    giverStats[recipient.giverName].denominations[denom] += count;
                });
            });

            // ç”Ÿæˆæ¯å€‹é€ç¦®äººçš„çµ±è¨ˆå¡ç‰‡
            giverSummaryContent.innerHTML = Object.entries(giverStats).map(([giverName, stats]) => {
                // ç”Ÿæˆæ”¶ç¦®äººæ˜ç´°
                const recipientSummaryHTML = Object.entries(stats.recipientDetails)
                    .map(([recipientName, amount]) => `
                        <div class="recipient-summary">
                            â†’ <span class="recipient-summary-name">${recipientName}</span> 
                            <span class="recipient-summary-amount">NT$ ${amount.toLocaleString()}</span>
                        </div>
                    `).join('');

                const bills = Object.entries(stats.denominations)
                    .filter(([denom, _]) => parseInt(denom) >= 100)
                    .filter(([_, count]) => count > 0);

                const coins = Object.entries(stats.denominations)
                    .filter(([denom, _]) => parseInt(denom) < 100)
                    .filter(([_, count]) => count > 0);

                let billsHTML = '';
                if (bills.length > 0) {
                    billsHTML = `
                        <div class="giver-bill-section">
                            <div class="giver-category-title">ğŸ’µ ç´™éˆ”</div>
                            <div class="giver-grid">
                                ${bills.map(([denom, count]) => `
                                    <div class="giver-denom-item">
                                        <div class="giver-denom-label">${denom}å…ƒ</div>
                                        <div class="giver-denom-count">${count}å¼µ</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                let coinsHTML = '';
                if (coins.length > 0) {
                    coinsHTML = `
                        <div class="giver-coin-section">
                            <div class="giver-category-title">ğŸª™ ç¡¬å¹£</div>
                            <div class="giver-grid">
                                ${coins.map(([denom, count]) => `
                                    <div class="giver-denom-item">
                                        <div class="giver-denom-label">${denom}å…ƒ</div>
                                        <div class="giver-denom-count">${count}æš</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="giver-card">
                        <div class="giver-name">ğŸ ${giverName}</div>
                        <div class="giver-recipients">
                            <div class="giver-recipients-title">ğŸ“‹ ç´…åŒ…æ˜ç´°</div>
                            ${recipientSummaryHTML}
                        </div>
                        <div class="giver-stats">
                            ${billsHTML}
                            ${coinsHTML}
                        </div>
                        <div class="giver-total">
                            <div class="giver-total-label">æ­¤äººç´…åŒ…ç¸½é¡</div>
                            <div class="giver-total-amount">NT$ ${stats.totalAmount.toLocaleString()}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderSummary() {
            const summary = document.getElementById('summary');
            const billSection = document.getElementById('billSection');
            const coinSection = document.getElementById('coinSection');
            const billGrid = document.getElementById('billGrid');
            const coinGrid = document.getElementById('coinGrid');
            const totalAmountEl = document.getElementById('totalAmount');

            if (recipients.length === 0) {
                summary.style.display = 'none';
                return;
            }

            summary.style.display = 'block';

            // è¨ˆç®—ç¸½è¨ˆ
            const totals = { 2000: 0, 1000: 0, 500: 0, 200: 0, 100: 0, 50: 0, 10: 0, 5: 0, 1: 0 };
            let totalAmount = 0;

            recipients.forEach(recipient => {
                totalAmount += recipient.amount;
                Object.entries(recipient.denominations).forEach(([denom, count]) => {
                    totals[denom] += count;
                });
            });

            // ç´™éˆ” (100å…ƒä»¥ä¸Š)
            const bills = Object.entries(totals)
                .filter(([denom, _]) => parseInt(denom) >= 100)
                .filter(([_, count]) => count > 0);

            if (bills.length > 0) {
                billSection.style.display = 'block';
                billGrid.innerHTML = bills
                    .map(([denom, count]) => `
                        <div class="summary-card">
                            <div class="summary-denomination">${denom} å…ƒ</div>
                            <div class="summary-count">${count} å¼µ</div>
                        </div>
                    `).join('');
            } else {
                billSection.style.display = 'none';
            }

            // ç¡¬å¹£ (50å…ƒä»¥ä¸‹)
            const coins = Object.entries(totals)
                .filter(([denom, _]) => parseInt(denom) < 100)
                .filter(([_, count]) => count > 0);

            if (coins.length > 0) {
                coinSection.style.display = 'block';
                coinGrid.innerHTML = coins
                    .map(([denom, count]) => `
                        <div class="summary-card">
                            <div class="summary-denomination">${denom} å…ƒ</div>
                            <div class="summary-count">${count} æš</div>
                        </div>
                    `).join('');
            } else {
                coinSection.style.display = 'none';
            }

            totalAmountEl.textContent = `NT$ ${totalAmount.toLocaleString()}`;
        }
    </script>
</body>
</html>
